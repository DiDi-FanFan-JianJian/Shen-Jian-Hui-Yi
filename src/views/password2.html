<html>

<head lang="zh-cn">
  <meta charset="gbk">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>�޸�����</title>

  <style type="text/css">
    input {
      font-family: Tahoma, Verdana, Arial, sans-serif;
    }
  </style>
  <script type="text/javascript" src="libs/jquery.js"></script>

  <script>
    $(function () {
      console.log("�޸�����ҳ��");
      $('#stu_no').text(localStorage.getItem('stu_no'));
      $("#logout").click(function () {
        localStorage.clear();
        $.ajax({
          url: "https://43.142.102.170/getLogout",
          type: "get",
          contentType: 'application/json',
        })
      })
    })

    function change() {
      var oldpassword = $("#oldpassword").val();
      var newpassword1 = $("#newpassword1").val();
      var newpassword2 = $("#newpassword2").val();
      var flag1 = new RegExp("\\d+");
      var flag2 = new RegExp("[a-zA-Z]+");
      var flag3 = new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>����/?~��@#������&*�����D�D|{}��������������'�������� ]");

      if (oldpassword.length == 0 || newpassword1.length == 0 || newpassword2.length == 0) {
        alert("������д������");
        return;
      }
      else if (newpassword1 !== newpassword2) {
        alert("��������������벻ͬ");
        return;
      }
      else if (newpassword1.length < 8 || newpassword1.length > 16) {
        alert("�����볤�Ȳ�����Ҫ��");
        return;
      }
      else if (!flag1.test(newpassword1)) {
        alert("��������ȱ������");
        return;
      }
      else if (!flag2.test(newpassword1)) {
        alert("��������ȱ����ĸ");
        return;
      }
      else if (!flag3.test(newpassword1)) {
        alert("��������ȱ�������ַ�");
        return;
      }
      $.ajax({
        url: "https://43.142.102.170/changePassword",
        type: "post",
        contentType: 'application/json',
        data: JSON.stringify({
          stu_no: localStorage.getItem("stu_no"),
          oldpassword: oldpassword,
          newpassword: newpassword1
        }),
        xhrFields: {
          withCredentials: true
        },
        crossDomain: true,
        success: function (data) {
          console.log(data);
          if (data.msg == 'success') {
            console.log("ȥ��ҳ��");
            alert('�޸ĳɹ�');
            $(location).attr("href", "index");
          }
          else if (data.msg == 'password error') {
            alert("�������");
          }
          else if (data.msg == 'system error') {
            alert("����������");
          }
        }
      })

      return;
    }
  </script>
</head>

<body>
  <div id="left" style="width:15%; height:500px; float:left;">
    <table align="left" width="85%" border="0" cellpadding="0" cellspacing="0">
      <left>
        <ul id="leftmenu"><br><br>����ϵͳ<li><a href="index">��ҳ</a></li>
          <li><a href="password">�޸�����</a></li>
          <li id="logout"><a href="login">�˳�</a></li>
        </ul>
      </left>
    </table>
  </div>

  <div id="main" style="width:30%; height:500px; float:left">
    <center>
      <h2>�޸�����</h2>
    </center><br />
    <table align="center" width="280" border="1" cellpadding="2" cellspacing="0">
      <tr>
        <td>&nbsp�û���: </td>
        <td id="stu_no"></td>
      </tr>
      <tr>
        <td>*�����룺</td>
        <td>
          <input id="oldpassword" type="password" name="oldpassword" size="18" value="" maxlength="16">
        </td>
      </tr>
      <tr>
        <td>*�����룺</td>
        <td>
          <input id="newpassword1" type="password" name="newpassword1" size="18" value="" maxlength="16">
        </td>
      </tr>
      <tr>
        <td>*�����룺</td>
        <td>
          <input id="newpassword2" type="password" name="newpassword2" size="18" value="" maxlength="16">
        </td>
      </tr>
      <tr>
        <td colspan="2" align="center"><button type="button" name="sub" onclick="change()">�ύ</button>
    </table>
    <table align="center" width="280" border="0" cellpadding="2" cellspacing="0" style="color:red" colspan="2">
      <font size="3" color="red">
        <tr>
          <th>���볤��Ϊ8-16λ</th>
        </tr>
        <tr>
          <th>����ͬʱ��������/��ĸ/�����ַ�</th>
        </tr>
      </font>
    </table>
  </div>

</body>

</html>